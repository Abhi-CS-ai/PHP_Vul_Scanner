# Define vulnerability patterns for PHP code
VULNERABILITY_PATTERNS = {
    "SQL Injection": {
        "pattern": r"(?:mysql_query|mysqli_query|pg_query)\s*\(\s*(?!.*\bprepare\b).*\$(?!_POST\[['\"]\w+['\"](?:\]|->))",
        "severity": "High",
        "remediation": "Use prepared statements with parameter binding (e.g., with PDO or mysqli_prepare) instead of direct variable insertion in SQL queries."
    },
"Cross-Site Scripting (XSS)": {
    "pattern": r"(echo|print|<?=)\s*\$_(?:GET|POST|REQUEST|COOKIE)\[.*?\]",
    "severity": "High",
    "remediation": "Sanitize output using htmlspecialchars() or a secure template engine."
},
    "File Inclusion": {
        "pattern": r"(?:include|require|include_once|require_once)\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)\[.+?\]",
        "severity": "High",
        "remediation": "Validate and sanitize file paths, use whitelisting, and never allow user input to directly specify file paths."
    },
    "Command Injection": {
        "pattern": r"(?:system|exec|shell_exec|passthru|eval|popen|proc_open)\s*\(\s*\$(?:_GET|_POST|_REQUEST|_COOKIE)",
        "severity": "High",
        "remediation": "Avoid using shell commands in PHP. If necessary, strictly validate user input and use escapeshellarg() or escapeshellcmd() functions."
    },
    "Insecure File Upload": {
        "pattern": r"move_uploaded_file\s*\(\s*\$_FILES\[.+?\]\[.+?\]",
        "severity": "Medium",
        "remediation": "Validate file types, scan for malicious content, use random filenames, and store uploads outside the web root."
    },
"Hardcoded Credentials": {
    "pattern": r"""(?i)(password|passwd|pwd|secret|credential[s]?)\s*["']?\s*[:=]\s*["']([^"']{4,})["']""",
    "severity": "Medium",
    "remediation": "Store sensitive credentials in environment variables or a secure configuration system, not directly in the code."
},
    "Session Fixation": {
        "pattern": r"session_id\s*\(\s*\$_(?:GET|POST|REQUEST|COOKIE)",
        "severity": "Medium",
        "remediation": "Always regenerate session IDs with session_regenerate_id() after authentication, and never accept session IDs from user input."
    },
    "Insecure Cryptographic Storage": {
        "pattern": r"(?:md5|sha1)\s*\(\s*\$(?:password|passwd|pwd)",
        "severity": "Medium",
        "remediation": "Use secure password hashing functions like password_hash() with appropriate options instead of MD5, SHA1, or other insecure hash functions."
    },
    "Insecure Cookie Configuration": {
        "pattern": r"setcookie\s*\([^,]+(,\s*[^,]+){2,5}\s*\)",
        "severity": "Low",
        "remediation": "Set the secure, httpOnly, and samesite attributes when creating cookies to protect against XSS and CSRF attacks."
    },
    "Information Disclosure": {
        "pattern": r"(?:phpinfo|var_dump|print_r|debug)\s*\(",
        "severity": "Low",
        "remediation": "Remove debug and information disclosure functions from production code to prevent leaking sensitive information."
    }
}